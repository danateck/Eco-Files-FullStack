<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoDocs Dashboard</title>
  <base href="/Eco-Files-FullStack/">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- CRITICAL: Import Map MUST come before any module scripts -->
  <script type="importmap">
  {
    "imports": {
      "firebase/app": "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js",
      "firebase/auth": "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js",
      "firebase/firestore": "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js",
      "firebase/storage": "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js"
    }
  }
  </script>
  <style>


html {
      overflow-x: hidden;
      max-width: 100vw;
    }


    .doc-actions{margin-top:auto;display:flex;gap:.5rem;flex-wrap:wrap}
    .doc-action-btn{border:1px solid var(--border-soft);background:#fff;border-radius:6px;
      padding:.35rem .55rem;font-size:.7rem;cursor:pointer}
    .doc-action-btn.danger{border-color:#e7b3b3;color:#8a1f1f;background:#fff4f4}
    .doc-action-btn.restore{border-color:#a3d6c1;color:#95a39f;background:#eefaf4}

    :root {

   
      --bg-app: #e1e3d5 ;
      --bg-card: #e1e3d5 ;
      --bg-sidebar-from: #aaab84 ;
      --bg-sidebar-to: #aaab84 ;
      --border-soft: rgba(91, 74, 56, 0.071);
      --text-dark: #71716b;
      --text-mid: #000000;
      --accent-soft: #51412f;
      --accent-strong: #382e14;
      --radius-lg: 16px;
      --radius-md: 10px;
      --radius-sm: 6px;
      --shadow-card: 0 12px 32px rgba(0,0,0,0.08);
      --shadow-topbar: 0 2px 6px rgba(0,0,0,0.08);
      --shadow-btn: 0 6px 16px rgba(0,0,0,0.18);
      --grad-btn: linear-gradient(to right, #3a7f5d, #5dbb8d);
    }
     *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      overflow-x: hidden;
      max-width: 100%;
       position: relative;
      margin: 0;
      background: var(--bg-app);
      font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text-dark);
      display: flex;
      min-height: 100vh;
    }

    /* ====== LAYOUT ====== */
    .dashboard {
      display: flex;
      width: 100%;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      max-width: 100vw;

    }

    .sidebar {
      background: #aaab84;
      color: #2c261f;
      width: 240px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      height: 100vh;
      position: relative;
      box-shadow: 4px 0 16px rgba(0,0,0,0.3);
      padding: 1rem 1rem 0;
      overflow: hidden; /* ✅ שינוי: לא overflow-y כדי שsidebar-bottom יהיה נראה */
    }
    
    /* ✅ תוכן הsidebar שיכול להיות ארוך */
    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 1rem;
    }

    .sidebar > div {
      flex-shrink: 0;
    }

    .sidebar-bottom {
      position: relative; /* ✅ שינוי: relative במקום absolute */
      width: 100%;
      padding: 0.75rem 1rem;
      box-sizing: border-box;
      border-top: 1px solid rgba(255,255,255,0.12);
      margin-top: auto; /* ✅ דוחף את זה לתחתית */
      flex-shrink: 0; /* ✅ מונע כיווץ */
      background: inherit; /* ✅ רקע כמו הsidebar */
    }

    .logout-btn {
      width: 100%;
      border: 0;
      border-radius: var(--radius-md);
      background: rgba(255,255,255,0.12);
      color: #fff;
      font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 600;
      font-size: .9rem;
      padding: .8rem .75rem;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,.4);
      transition: background .18s, filter .18s;
    }
    .logout-btn:hover {
      background: rgba(255,255,255,0.18);
      filter: brightness(1.05);
    }

    /* מובייל: המגירה */
    @media (max-width: 760px) {
      .sidebar {
             position: fixed;
  top: 0;
  right: 0; /* slide in/out from the right side */
      box-shadow: 4px 0 16px rgba(0,0,0,0.3);
      padding: 1rem 1rem 0;
      overflow-y: auto; /* גלילה אם התוכן גבוה */
      transform: translateX(100%); /* start off-screen to the right */
  transition: transform 0.35s ease-in-out;
        top: 0;
        right: 0;
        height: 100vh;
        max-height: 100vh;
        width: 220px;
        max-width: 80%;
        box-shadow: 0 0 30px rgba(0,0,0,0.6);
        z-index: 9999;
        background: linear-gradient(180deg, var(--bg-sidebar-from) 0%, var(--bg-sidebar-to) 100%);
        transform: translateX(100%);
      }
      .sidebar.open {
        transform: translateX(0);
      }
    }

    .brand-block {
      display: flex;
      flex-direction: column;
      gap: .5rem;
      padding: .5rem .25rem 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.12);
    }

    .brand-name {
      font-size: .9rem;
      font-weight: 600;
      color: #1f2717;
      letter-spacing: .03em;
      line-height: 1.2;
    }

    .brand-sub {
      font-size: .7rem;
      font-weight: 400;
      color: #1f2717;
      line-height: 1.4;
    }

    .user-panel {
      margin-top: .75rem;
      background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius-md);
      padding: .6rem .75rem;
      font-size: .8rem;
      line-height: 1.4;
      color: #fff;
      display: flex;
      flex-direction: column;
      gap: .25rem;
    }

    .user-panel-name {
      font-weight: 500;
      color: #1f2717;
      font-size: .8rem;
    }

    .user-panel-mail {
      color: rgba(48, 57, 46, 0.7);
      font-size: .7rem;
      direction: ltr;
      unicode-bidi: plaintext;
      word-break: break-all;
    }



    .hidden { display: none !important; }

/* Backdrop allows scroll on small screens */
.modal-backdrop {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 9999;
  overflow: auto;
  padding: 16px;
  min-height: 100dvh;
}
.modal {
  background: var(--c-bg,#fff);
  color: var(--c-fg,#0f141a);
  width: min(720px, 94vw);
  margin: 24px auto;
  border-radius: 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.28);
  display: grid;
  grid-template-rows: auto 1fr auto;
  max-height: 88dvh;
  overflow: hidden;
}
.modal-head {
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px; position:sticky; top:0; background:var(--c-bg,#fff);
  border-bottom:1px solid var(--c-border,#e6e6e6); z-index:1;
}
.modal-head h2{margin:0;font-size:1.2rem}
.modal-close{border:0;background:transparent;cursor:pointer;font-size:1.1rem;color:var(--c-fg,#0f141a)}
.scroll-area{overflow:auto;-webkit-overflow-scrolling:touch;padding:10px 16px; margin-right: 20px;}
.modal-foot{padding:10px 16px 14px;border-top:1px solid var(--c-border,#e6e6e6);position:sticky;bottom:0;background:var(--c-bg,#fff)}

.section{margin:10px 0 16px}
.section h3{margin:0 0 8px;font-size:1rem;opacity:.9}
.row{display:flex;align-items:center;gap:10px;margin:10px 0}
.switch input{margin-inline-end:8px}

select, .btn{
  padding:8px 12px;border-radius:10px;border:1px solid var(--c-border,#e6e6e6);
  background:var(--c-btn,#f2f2f2); color:var(--c-fg,#0f141a);
}
.btn{cursor:pointer}

/* Compact density: you can hook your cards/list to this class */
.compact-density .doc-card{padding:8px !important}
.compact-density .grid{gap:8px !important}

/* Reduce motion */
.reduce-motion *{animation:none!important;transition:none!important}

/* Theme tokens (light default) + dark */
:root{
  --c-bg:#ffffff; --c-fg:#0f141a; --c-border:#e6e6e6; --c-btn:#f2f2f2;
}
.theme-dark{
  --c-bg:#111417; --c-fg:#e8eef5; --c-border:#2a2f35; --c-btn:#1d232a;
}

/* Mobile */
@media (max-width:560px){
  .modal{width:100%;margin:0 auto;max-height:100dvh;border-radius:0}
}

    nav.menu {
      display: flex;
      flex-direction: column;
      padding-top: 1rem;
      gap: .25rem;
    }

    .menu-label {
      color: rgba(83, 20, 20, 0.5);
      font-size: .7rem;
      font-weight: 500;
      letter-spacing: .05em;
      padding: 0 .5rem;
      margin-bottom: .25rem;
    }

    .menu-item {
      background: transparent;
      border: none;
      color: #151f12;
      display: flex;
      align-items: center;
            font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

      gap: .6rem;
      padding: .6rem .5rem .6rem .75rem;
      border-radius: var(--radius-md);
      font-weight: 500;
      font-size: .8rem;
      cursor: pointer;
      text-align: right;
      width: 100%;
      transition: background .18s;
    }

    .menu-item:hover,
    .menu-item.active {
      background: rgba(255,255,255,0.12);
    }

    .menu-item-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-md);
      background: rgba(255,255,255,0.12);
      display: grid;
      place-items: center;
      font-size: .8rem;
      font-weight: 500;
    }

    .main-area {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      max-height: 100vh;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      align-items: center;
      background: #aaab84 ;
      padding: .8rem 1rem;
      box-shadow: var(--shadow-topbar);
      border-bottom: 1px solid var(--border-soft);
      z-index: 5;
    }

    .top-left {
      display: flex;
      flex-direction: column;
    }

    .page-title {
      margin: 0;
      font-size: .95rem;
      font-weight: 600;
      color: var(--text-dark);
      line-height: 1.3;
    }

    .page-sub {
      margin: 0;
      font-size: .7rem;
      color: var(--text-mid);
      line-height: 1.4;
    }

    .top-right {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: .5rem;
    }

    .mobile-menu-btn {
      display: none;
      background: transparent;
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      line-height: 1;
      padding: .4rem .6rem;
      cursor: pointer;
      color: var(--text-dark);
      background-color: #301919;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }

    .upload-btn {
      background: #301919;
      color: #b4b1b1;
      font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      border: 0;
      border-radius: var(--radius-md);
      font-size: .8rem;
      font-weight: 600;
      padding: .55rem .8rem;
      cursor: pointer;
      box-shadow: var(--shadow-btn);
      transition: filter .18s, transform .18s;
    }
    .upload-btn:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .hidden-input {
      display: none;
    }

    .tabs-bar {
      background: #707a4e ;
      border-bottom: 1px solid #d6e6df;
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      padding: .6rem 1rem;
    }

    .tab-btn {
      background: #b4ac81;
      border: 0;
      font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      border-radius: var(--radius-sm);
      font-size: .75rem;
      font-weight: 500;
      padding: .4rem .7rem;
      cursor: pointer;
      color: #342a15;
      line-height: 1.2;
      transition: background .15s;
    }

  
    .content-scroll-area {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding: 1rem;
      display: grid;
      grid-template-rows: auto auto 1fr;
      row-gap: 1rem;
    }

    .home-view,
    .category-view {
      background: transparent;
      border-radius: var(--radius-lg);
    }

    .view-title {
      font-size: .9rem;
      font-weight: 600;
      color: var(--text-dark);
      margin: 0 0 .75rem;
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .folder-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      align-items: start;
      justify-items: center;
    }

    @media (min-width: 500px) {
      .folder-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    @media (min-width: 700px) {
      .folder-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    @media (min-width: 1000px) {
      .folder-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    @media (min-width: 1300px) {
      .folder-grid {
        grid-template-columns: repeat(6, 1fr);
      }
    }

    .folder-card {
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-md);
      padding: 2.2rem 3rem;
      box-shadow: var(--shadow-card);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: .7rem;
      transition: transform .18s, box-shadow .18s;
      text-align: right;
      width: 100%;
      max-width: 320px;
    }
    .folder-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(0,0,0,0.12);
    }

    .folder-icon {
      width: 40px;
      height: 32px;
      border-radius: 6px;
      background: #f3dd86;
      box-shadow: 0 6px 12px rgba(107,99,28,0.62);
      position: relative;
    }
    .folder-icon::before {
      content: "";
      position: absolute;
      top: -6px;
      right: 4px;
      width: 18px;
      height: 8px;
      border-radius: 3px 3px 0 0;
      background: linear-gradient(135deg,#efe5b6 0%,#ffe694 100%);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    .folder-label {
      font-size: .8rem;
      font-weight: 600;
      color: var(--text-dark);
      line-height: 1.3;
      font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .category-view-header {
      display: flex;
      align-items: center;
      gap: .5rem;
      margin-bottom: .75rem;
    }

    .back-button {
      background: transparent;
      border: 1px solid var(--border-soft);
      border-radius:12px;
      padding: .4rem .6rem;
      font-size: .8rem;
      cursor: pointer;
      color: var(--accent-strong);
      background-color: #cacab7;
      transition: box-shadow .18s;
    }
    .back-button:hover {
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    .category-title {
      font-size: .85rem;
      font-weight: 600;
      color: var(--text-dark);
      margin: 0;
    }

    .docs-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
      gap: 1rem;
      justify-items: center;
    }

.docs-list.shared-mode {
  display: flex !important;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 100vw;
  margin: 0 auto;
  padding: 0 clamp(8px, 2vw, 16px);
  box-sizing: border-box;
  overflow-x: hidden;
}
    
    .doc-card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-card);
      padding: .8rem .8rem .9rem;
      font-size: .8rem;
      line-height: 1.4;
      color: var(--text-dark);
      display: flex;
      flex-direction: column;
      gap: .5rem;
      width: 100%; max-width: none; 
      min-height: 140px;
      position: relative;
    }

    .doc-card-title {
      font-weight: 600;
      font-size: .8rem;
      margin: 0;
      color: var(--text-dark);
    }

    .doc-card-meta {
      font-size: .7rem;
      color: var(--text-mid);
      line-height: 1.4;
      display: flex;
      flex-direction: column;
      gap: .25rem;
    }

    .doc-open-link {
      font-size: .8rem;
      font-weight: 600;
      color: #d9d9d9;
      text-decoration: none;
      background: #60683f;
      padding: .5rem .9rem;
      padding-right: 11px;
      width: fit-content;
      font-family: 'Rubik', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

      border-radius: var(--radius-sm);
      box-shadow: 0 6px 14px rgba(0,0,0,0.25);
      transition: background .18s, color .18s;
      display: inline-block;
    }
    .doc-open-link:hover {
      background: #21370c;
      color: #dbdbdb;
    }



/* header row: title on right, X on left (works great in RTL, too) */
.brand-row {
  display: flex;
  align-items: center;
  justify-content: end; /* pushes title to right, X to left */
  gap: 12px;
  padding: 10px px;
  padding-bottom: 10px;
  border-bottom: 1px solid #282f08;
  direction: ltr; 
}

.brand-name {
  font-size: 1.4rem;
  font-weight: 700;
  margin: 0;
}

/* the X button */
.close-btn {
  display: none; 
  background: transparent;
  border: none;
  font-size: 1.4rem;
  line-height: 1;
  cursor: pointer;
  color: #555;
  padding: 4px 6px;
  border-radius: 10px;
  transition: background-color .15s ease, color .15s ease;
}
.close-btn:hover { background: rgba(0,0,0,0.06); color: #e53935; }

/* optional dark mode variants */
body.dark-mode .brand-row { border-bottom-color: #2b2b2b; }
body.dark-mode .close-btn { color: #eee; }
body.dark-mode .close-btn:hover { background: rgba(255,255,255,0.06); color: #ff7675; }


/* when menu is open */
.sidebar.open {
  transform: translateX(0); /* slide into view */
}

/* optional dark mode support */
body.dark-mode .sidebar {
  background: #181a1b;
  color: #eee;
}





.top-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.premium-btn {
  background: linear-gradient(90deg, #fefff5, #fefff5);
  border: none;
  color: #1e1e1e;
  font-weight: bold;
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.premium-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 10px rgba(54, 49, 24, 0.6);
}

/* ========== Responsive, scrollable modal ========== */
.hidden { display: none !important; }

/* Backdrop now scrolls if needed and pads content */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 9999;

  /* allow scroll on small screens */
  overflow: auto;
  padding: 16px;                 /* space around modal on tiny screens */
  /* use modern viewport to avoid mobile address bar bugs */
  min-height: 100dvh;            
}

/* Center via auto margins; cap height and allow inner scrolling */
.modal {
  background: var(--c-bg, #fff);
  color: var(--c-fg, #0f141a);
  width: min(920px, 94vw);
  margin: 24px auto;             /* centers in the scrolling backdrop */
  border-radius: 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.28);

  display: grid;
  grid-template-rows: auto 1fr auto; /* head | content | foot */
  gap: 12px;

  max-height: 88dvh;             /* so it never overflows the screen */
  overflow: hidden;              /* clip at container; content area scrolls */
}

/* Keep header/close visible while content scrolls */
.modal-head {
  display: flex; align-items: center; justify-content: space-between;
  gap: 10px;
  padding: 14px 16px;
  position: sticky; top: 0;
  background: var(--c-bg, #fff);
  z-index: 1;
  border-bottom: 1px solid var(--c-border, #e6e6e6);
}
.modal-head h2 { margin: 0; font-size: 1.2rem; }
.modal-close {
  border: 0; background: transparent; cursor: pointer; font-size: 1.1rem;
  color: var(--c-fg, #0f141a);
}

/* Scroll only the middle content area (text + plans) */
.modal > .muted,
.modal > .plans-grid {
  padding: 0 16px;
}
.muted { opacity: .85; margin: 8px 0 10px; margin-right: 12px}

/* Wrap content to be scrollable (1fr area) */
.modal .scroll-area {
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  padding: 0 0 10px;
}

/* Plans grid responsive */
.plans-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  padding: 0 16px 6px;
}
.plan {
  border: 1px solid var(--c-border, #e6e6e6);
  background: var(--c-card, #f9f9f9);
  border-radius: 12px;
  padding: 12px;
  display: grid; gap: 10px;
}
.plan header { display: flex; align-items: baseline; justify-content: space-between; }
.plan h3 { margin: 0; }
.price { font-size: 1.15rem; font-weight: 700; }
.price .per { font-size: .9rem; opacity: .7; margin-inline-start: 4px; }
.features { margin: 0; padding-inline-start: 18px; display: grid; gap: 4px; }

/* Footer stays visible */
.modal-foot {
  padding: 10px 16px 14px;
  border-top: 1px solid var(--c-border, #e6e6e6);
  position: sticky; bottom: 0;
  background: var(--c-bg, #fff);
}

/* Buttons */
.btn {
  padding: 10px 14px;
  border-radius: 10px;
  border: 1px solid var(--c-border, #e6e6e6);
  background: var(--c-btn, #f2f2f2);
  color: var(--c-fg, #0f141a);
  cursor: pointer;
  width: 100%;                 /* better for mobile tap targets */
}
.btn-ghost { background: transparent; }
.btn-accent {
  background: linear-gradient(90deg, #ffd700, #ffb300);
  border: none; color: #222; font-weight: 700;
}

/* Premium accent card */
.plan-accent {
  border: 1px solid #ffd86b;
  background: linear-gradient(180deg, #fff7d6, #fff);
}

/* ---------- Mobile tweaks ---------- */
@media (max-width: 900px) {
  .plans-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 560px) {
  .modal { width: 100%; margin: 0 auto; border-radius: 0; max-height: 100dvh; }
  .modal-head, .modal-foot { padding: 12px; }
  .plans-grid { grid-template-columns: 1fr; padding: 0 12px 6px; }
  .plan { padding: 10px; }
}

/* ---------- Dark theme tokens (if you use .theme-dark) ---------- */
.theme-dark {
  --c-bg: #111417;
  --c-fg: #e8eef5;
  --c-border: #2a2f35;
  --c-card: #151a1f;
  --c-btn: #1d232a;
}

/* Optional: better focus outline */
:where(button, [href], input, select, textarea, [tabindex]):focus-visible {
  outline: 2px solid #7aa7ff;
  outline-offset: 2px;
}



    .notification {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%) translateY(-10px);
      background-color: #0e3535;
      color: #fff;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 500;
      box-shadow: 0 12px 24px rgba(0,0,0,0.25);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 9999;
    }
    .notification.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    .notification.error {
      background-color: #b63a3a;
    }
    .notification.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .hidden { display: none !important; }

    @media (max-width: 760px) {
      .top-bar { border-radius: 0; }
      .mobile-menu-btn { display: inline-block; }
    }
    @media (min-width: 761px) {
      .mobile-menu-btn { display: none; }
    }


    @media (max-width: 760px) {
  .close-btn {
    display: inline-block;  /* במובייל רואים את האיקס */
  }
}

@media (min-width: 761px) {
  .close-btn {
    display: none;          /* במסכים גדולים האיקס נעלם */
  }
}


    .mobile-logout {
      display: none;
    }

/* ==== Shared (Cozy) ==== */
.shared-manage { display:grid; gap:16px; }

/* ===== Shared Folder Layout - קבוע לכל הגדלים ===== */
.cozy-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #bec4ab;
  color: #1f3e30;
  border: 1px solid #2d3b3b;
  border-radius: 14px;
  padding: 12px 14px;
  box-shadow: 0 12px 28px rgba(0,0,0,.22);
  width: 100%;
  box-sizing: border-box;
  margin-top: 14px;
}

.cozy-head h3 {
  margin: 0;
  font-size: 1rem;
  font-weight: 700;
  letter-spacing: .3px;
}

.btn-cozy {
  background: #e1e3d5;
  color: #53574c;
        font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  border: 1px solid #2e5a5a;
  border-radius: 10px;
  padding: .55rem .8rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(0,0,0,.28);
  transition: .18s;
  white-space: nowrap;
}

.btn-cozy:hover {
  filter: brightness(1.08);
  transform: translateY(-1px);
}

/* תיקיות משותפות - כרטיסים */
.sf-card {
  width: 100%;
  max-width: 100%;
  display: grid;
  grid-template-columns: 56px 1fr auto;
  align-items: center;
  gap: 14px;
 background: #bec4ab;
  color: #53574c;
        font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  border: 1px solid #515e56;
  border-radius: 16px;
  padding: 14px;
  box-shadow: 0 16px 34px rgba(0,0,0,.25);
  margin: 6px 0;
  box-sizing: border-box;
}

.sf-ico {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  display: grid;
  place-items: center;
  background: #ffffff;
  border: 1px solid #515e56;
  font-size: 18px;
}

.sf-main {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 0;
}

.sf-title {
  font-size: 1.05rem;
  font-weight: 700;
  color: #0e2d28;
  margin: 0;
  word-break: break-word;
}

.sf-meta {
  font-size: .85rem;
  color: #62554d;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.sf-actions {
  display: flex;
  gap: 8px;
  flex-wrap: nowrap;
  justify-content: flex-end;
  align-items: center;
}

/* במובייל - שנה לעמודה */
@media (max-width: 640px) {
  .sf-card {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .sf-actions {
    flex-wrap: wrap;
    justify-content: flex-start;
  }
}

.btn-min {
  background: #e1e3d5;
  color: #142220;
  border: 1px solid #2b3c3c;
  border-radius: 10px;
  padding: .42rem .6rem;
  font-size: .78rem;
  cursor: pointer;
  white-space: nowrap;
}

.btn-min:hover {
  background: #e1e3d5;
}

.btn-danger {
  background: #a83737;
  color: #fdfcfc;
  border: 1px solid #733a3a;
}

.btn-danger:hover {
  background: #a83737;
}

/* בקשות ממתינות */
.pending-wrap {
  background: #bec4ab;
  color: #53574c;
        font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  border: 1px solid #243030;
  border-radius: 14px;
  padding: 14px;
 
  box-shadow: 0 12px 28px rgba(0,0,0,.22);
  width: 100%;
  box-sizing: border-box;
  margin-top: 14px;
}

/* Container ראשי - ממורכז באמצע */
.shared-container {
  max-width: 900px;
  width: 100%;
  margin: 14px auto 0;
  padding: 0 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
}

/* Container עבור שלושת הבלוקים העליונים */
/* .shared-top-blocks {
  display: flex;
  flex-direction: column;
  gap: 14px;
  width: 100%;
  max-width: 900px;
  margin: 0 auto 20px;
} */

/* כל הבלוקים החומים - רוחב מלא */
.cozy-head,
.pending-wrap,
.sf-list {
  width: 100%;
  max-width: 900px;
}

/* כשנמצאים בתצוגת תיקייה משותפת ספציפית */
/* .docs-list.shared-mode {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 100%;
  margin: 0 auto;
  padding: 0 16px;
  box-sizing: border-box;
  overflow-x: hidden;
} */

/* Container עבור שלושת הבלוקים העליונים */
/* .shared-top-blocks {
  display: flex;
  flex-direction: column;
  gap: 14px;
  width: 100%;
  max-width: 900px;
  margin: 0 auto 20px;
  box-sizing: border-box;
} */

/* מסמכים משותפים - Grid רספונסיבי */
/* .docs-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(min(280px, 100%), 1fr));
  gap: 20px;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
  box-sizing: border-box;
} */

/* במובייל - התאמות */
@media (max-width: 768px) {
  .docs-grid {
    grid-template-columns: 1fr;
    max-width: 100%;
  }
  
  .shared-top-blocks {
    max-width: 100%;
  }
}

@media (max-width: 640px) {
  .docs-list.shared-mode {
    padding: 0 8px;
  }
  
  .docs-grid {
    grid-template-columns: 1fr;
  }
  
  .cozy-head {
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }
  
  .cozy-head > div {
    width: 100%;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .btn-cozy {
    flex: 1;
    min-width: 120px;
  }
  
  .sf-card {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .sf-actions {
    flex-wrap: wrap;
    justify-content: flex-start;
 flex-wrap: wrap;
    justify-content: flex-start;
  }
}
   


/* SF List - רשימת תיקיות */
.sf-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
}

/* אם עדיין לא מספיק, אפשר להגדיל את המרחק */
@media (min-width: 1000px) {
  .shared-container {
    margin-right: 20px !important;
  }
}



element.style {
    display: grid
;
    gap: 92px;
    margin: 28px;
}










.shared-view {
  display: block;
  width: 100%;
  margin-top: 20px;
}

.shared-block {
  background: #2e2512;
  border: 1px solid #515e56;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 24px;
  color: #cfe2df;
  box-shadow: 0 12px 28px rgba(0,0,0,.22);
}

.shared-block h3 {
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 1rem;
  font-weight: 700;
}











/* ==== TETROMINO ANIMATION ==== */

/* אריח בודד */
.tetromino {
  width: 96px;
  height: 112px;
  position: absolute;
  transition: all ease .3s;
  background: url('data:image/svg+xml;utf-8,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 684"%3E%3Cpath fill="%23010101" d="M305.7 0L0 170.9v342.3L305.7 684 612 513.2V170.9L305.7 0z"/%3E%3Cpath fill="%23fff" d="M305.7 80.1l-233.6 131 233.6 131 234.2-131-234.2-131"/%3E%3C/svg%3E') no-repeat top center;
}

/* מהירות: 1.5 שניות; מרחקים: xspace=48px, yspace=27px */
.box1 { animation: tetromino1 1.5s ease-out infinite; }
.box2 { animation: tetromino2 1.5s ease-out infinite; }
.box3 { animation: tetromino3 1.5s ease-out infinite; z-index: 2; }
.box4 { animation: tetromino4 1.5s ease-out infinite; }

@keyframes tetromino1 {
  0%, 40%   { transform: translate(0px, 0px); }
  50%       { transform: translate(48px, -27px); }
  60%, 100% { transform: translate(96px, 0px); }
}

@keyframes tetromino2 {
  0%, 20%   { transform: translate(96px, 0px); }
  40%, 100% { transform: translate(144px, 27px); }
}

@keyframes tetromino3 {
  0%        { transform: translate(144px, 27px); }
  20%, 60%  { transform: translate(96px, 54px); }
  90%, 100% { transform: translate(48px, 27px); }
}

@keyframes tetromino4 {
  0%, 60%   { transform: translate(48px, 27px); }
  90%, 100% { transform: translate(0px, 0px); }
}


/* ==== LOADING — FINAL OVERRIDES ==== */
#loading-overlay.hidden { opacity: 0 !important; pointer-events: none !important; }

#loading-overlay {
  position: fixed !important;
  inset: 0 !important;
  display: grid !important;
  place-items: center !important;
  z-index: 99999 !important;
  background: rgba(0,0,0,.75) !important;
}

#loading-overlay .loading-stack {
  display: flex   !important;
  flex-direction: column !important;
  align-items: center !important;
   top: 50% !important;
     transform: translate(-50%, -50%) !important;

  left: 50% !important;
  gap: 16px !important;      /* רווח בין האנימציה לטקסט */
  text-align: center !important;
}

/* מסגרת מוגדרת לגודל האנימציה, כדי שלא תגלוש על הטקסט */
#loading-overlay .tetro-frame {
  width: 220px !important;      /* אפשר לשנות גודל כאן */
  height: 180px !important;
  position: relative !important;
  margin: 0 auto !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* מבטלים לחלוטין את המיקום הישן של tetrominos */
#loading-overlay .tetrominos {
  position: relative !important; /* לא absolute כאן */
  inset: auto !important;
  top: auto !important;
  left: auto !important;
  right: auto !important;
  bottom: auto !important;
  transform: none !important;
  margin: 0 auto !important;
  width: 192px !important;      /* גודל האנימציה */
  height: 140px !important;
}

/* גודל ה"אריחים" נשאר, אבל אפשר לכוונן את הסקייל אם גדול מדי */
#loading-overlay .tetrominos { transform: scale(0.9) !important; } /* 0.8/1.0 לפי הטעם */
#loading-overlay .loading-stack { gap: -12px !important; } /* או 20px */


#loading-overlay .loading-text {
  display: block !important;
  margin: 0 auto !important;
  margin-right: -84px !important;
  width: 100% !important;
  max-width: 80vw !important;       /* אפשר לשנות אם יש שורה ארוכה */
  text-align: right !important;     /* זה הטריק המרכזי */
  direction: rtl !important;         /* עברית */
  unicode-bidi: plaintext !important;
  line-height: 1.35 !important;
  font-weight: 600 !important;
  color: #fff !important;
}





/* Settings Panel Styles */
.section {
  margin: 20px 0;
}

.section-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-dark);
}

.card {
  background: var(--bg-card);
  border: 1px solid var(--border-soft);
  border-radius: var(--radius-md);
  padding: 16px;
  margin-bottom: 12px;
}

.block-label {
  display: block;
  font-weight: 600;
  margin-bottom: 10px;
  font-size: 0.85rem;
}

.theme-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: 2px solid var(--border-soft);
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.2s;
  background: var(--bg-card);
}

.pill input[type="radio"] {
  margin: 0;
}

.pill:has(input:checked) {
  background: var(--accent-soft);
  border-color: var(--accent-strong);
  color: #fff;
}

.switch {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
}

.switch input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.hint {
  font-size: 0.75rem;
  color: var(--text-mid);
  margin-top: 8px;
  opacity: 0.8;
}

.grid-2 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 12px;
}

/* Dark Mode Variables */
.theme-dark {
  --bg-app: #1a1a1a;
  --bg-card: #2a2a2a;
  --bg-sidebar-from: #0f0f0f;
  --bg-sidebar-to: #B6A581;
  --border-soft: rgba(255, 255, 255, 0.1);
  --text-dark: #e0e0e0;
  --text-mid: #b0b0b0;
  --accent-soft: #d67a7a;
  --accent-strong: #e8d4b4;
  --shadow-card: 0 12px 32px rgba(0,0,0,0.5);
  --shadow-topbar: 0 2px 6px rgba(0,0,0,0.3);
}

.theme-dark body {
  background: var(--bg-app);
  color: var(--text-dark);
}

.theme-dark .top-bar {
  background: #3a4a3a;
}

.theme-dark .tabs-bar {
  background: #1a1a0a;
  border-bottom-color: #3a3a3a;
}

.theme-dark .page-title,
.theme-dark .page-sub {
  color: var(--text-dark);
}

.theme-dark .upload-btn {
  background: #4a3a3a;
  color: #e0e0e0;
}

.theme-dark .folder-card,
.theme-dark .doc-card {
  background: var(--bg-card);
  border-color: var(--border-soft);
}

.theme-dark .modal {
  background: #2a2a2a;
  color: #e0e0e0;
}

.theme-dark .modal-head,
.theme-dark .modal-foot {
  background: #2a2a2a;
  border-color: rgba(255, 255, 255, 0.1);
}

.theme-dark .btn {
  background: #3a3a3a;
  color: #e0e0e0;
  border-color: rgba(255, 255, 255, 0.1);
}

.theme-dark .card {
  background: #333;
  border-color: rgba(255, 255, 255, 0.1);
}

.theme-dark .pill {
  background: #3a3a3a;
  border-color: rgba(255, 255, 255, 0.1);
  color: #e0e0e0;
}

.theme-dark .pill:has(input:checked) {
  background: #d67a7a;
  border-color: #e8d4b4;
}


/* ========== תיקון גלילה רוחבית וריכוז - גרסה סופית ========== */

/* תיקון גלובלי */
html {
  overflow-x: hidden !important;
  max-width: 100vw;
}

body {
  overflow-x: hidden !important;
  max-width: 100vw;
}

.dashboard {
  overflow-x: hidden !important;
  max-width: 100vw;
}

/* תיקון docsList במצב shared */
.docs-list.shared-mode {
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  width: 100% !important;
  max-width: 100vw !important;
  margin: 0 auto !important;
  padding: 0 16px !important;
  box-sizing: border-box !important;
  overflow-x: hidden !important;
}

/* Container של 3 הבלוקים */
.shared-top-blocks {
  display: flex !important;
  flex-direction: column !important;
  gap: 14px !important;
  width: 100% !important;
  max-width: 900px !important;
  margin: 0 auto 20px !important;
  padding: 0 !important;
  box-sizing: border-box !important;
}

/* כל הבלוקים החומים */
.cozy-head,
.pending-wrap,
.sf-list {
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  overflow: hidden !important;
}

/* Grid המסמכים */
.docs-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fill, minmax(min(280px, 100%), 1fr)) !important;
  gap: 20px !important;
  width: 100% !important;
  max-width: 1200px !important;
  margin: 0 auto !important;
  padding: 0 !important;
  box-sizing: border-box !important;
}

/* תיקון כרטיסי מסמכים */
.doc-card {
  max-width: 100% !important;
  box-sizing: border-box !important;
  overflow: hidden !important;
}

.doc-card-title {
  word-break: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important;
  max-width: 100% !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  display: -webkit-box !important;
  -webkit-line-clamp: 2 !important;
  -webkit-box-orient: vertical !important;
}

/* מסכים בינוניים (768px - 1024px) */
@media (max-width: 1024px) {
  .docs-list.shared-mode {
    padding: 0 12px !important;
  }
  
  .shared-top-blocks {
    max-width: calc(100vw - 24px) !important;
  }
  
  .docs-grid {
    max-width: calc(100vw - 24px) !important;
    grid-template-columns: repeat(auto-fill, minmax(min(250px, 100%), 1fr)) !important;
    gap: 16px !important;
  }
}

/* מסכים קטנים (640px - 768px) */
@media (max-width: 768px) {
  .docs-list.shared-mode {
    padding: 0 8px !important;
  }
  
  .shared-top-blocks {
    max-width: calc(100vw - 16px) !important;
  }
  
  .docs-grid {
    grid-template-columns: repeat(auto-fill, minmax(min(220px, 100%), 1fr)) !important;
    max-width: calc(100vw - 16px) !important;
    gap: 12px !important;
  }
  
  .cozy-head {
    flex-direction: column !important;
  }
  
  .cozy-head > div {
    width: 100% !important;
  }
}

/* מובייל (מתחת ל-640px) */
@media (max-width: 640px) {
  .docs-list.shared-mode {
    padding: 0 8px !important;
  }
  
  .shared-top-blocks {
    max-width: calc(100vw - 16px) !important;
    gap: 10px !important;
  }
  
  .docs-grid {
    grid-template-columns: 1fr !important;
    max-width: calc(100vw - 16px) !important;
    gap: 10px !important;
  }
  
  .btn-cozy {
    width: 100% !important;
    padding: 10px !important;
  }
}

/* מובייל קטן מאוד (מתחת ל-480px) */
@media (max-width: 480px) {
  .docs-list.shared-mode {
    padding: 0 4px !important;
  }
  
  .shared-top-blocks {
    max-width: calc(100vw - 8px) !important;
  }
  
  .docs-grid {
    max-width: calc(100vw - 8px) !important;
  }
  
  .cozy-head h3 {
    font-size: 1.1rem !important;
  }
}

/* ========== סוף התיקון ========== */




.small-btn {
  background: #505733;
  color: #cbc7be;
        font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  padding: 0.45rem 1rem;
  border-radius: 12px;
  border: none;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}

.small-btn:hover {
  background: #878e6b;
  color: rgb(30, 17, 9);
}


.subfolders-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  margin: 0.5rem 0 0.8rem;
}

.subfolders-bar button {
  font-size: 0.75rem;
  padding: 0.3rem 0.6rem;
  border-radius: 999px;
  border: 1px solid #04280b;
          font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  background: #eef3ec;
  cursor: pointer;
}

.subfolders-bar button.active {
          font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  background: #b7ad8c;
  color: #400c0c;
  border-color: #b7ad8c;
}






/* ==== Eco Alert Styles ==== */

#eco-alert-root {
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  pointer-events: none;
}

.eco-alert {
  pointer-events: auto;
  margin-top: 25px;
  padding: 18px 20px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.25);
  width: min(350px, 90%);
  animation: dropDown 0.35s ease;
  font-family: sans-serif;
  display: flex;
  gap: 12px;
  direction: rtl;
}

.eco-alert-icon {
  font-size: 22px;
}

.eco-alert-title {
  font-size: 0.95rem;
  font-weight: 600;
  margin: 0;
}

@keyframes dropDown {
  0%   { opacity: 0; transform: translateY(-30px) scale(.96); }
  60%  { opacity: 1; transform: translateY(4px) scale(1.02); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

.eco-success { border-right: 4px solid #16a34a; }
.eco-error   { border-right: 4px solid #dc2626; }
.eco-warning { border-right: 4px solid #d97706; }
.eco-info    { border-right: 4px solid #2563eb; }
















.overlay {
  position: fixed;
  width: 100%;
  height: 100%;
  inset: 0;
  background: rgba(0,0,0,.65);
  z-index: 999999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.popup {
  background: #e1dbcf;
  padding: 24px 28px;
  border-radius: 12px;
  width: min(340px, 90%);
  animation: dropDown .35s ease;
  direction: rtl;
}

@keyframes dropDown {
  0% {opacity:0; transform: translateY(-30px) scale(.96);}
  60% {opacity:1; transform: translateY(3px) scale(1.02);}
  100% {opacity:1; transform: translateY(0) scale(1);}
}

.btn {
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.btn-primary {
  background: #C04C4C;
  color: white;
  border: none;
}

.btn-cancel {
  background: #F5F1EB;
  color: black;
  border: none;
}




.buttons {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 12px;          /* רווח בין הכפתורים */
  flex-direction: row;
}

.btn {
  flex: 1;            /* הכפתורים יהיו שווים ברוחב */
  padding: 10px 0;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  border: none;
  font-size: 0.95rem;
}

.btn-primary {
  background: #CB7F29;
  color: white;
}

.btn-cancel {
  background: #e5e5e5;
  color: #222;
  border-color: #614628 ;
}






/* === GLOBAL BEAUTIFUL SCROLLBAR FOR WHOLE SITE === */

/* Firefox */
html, body, * {
  scrollbar-width:auto;
  scrollbar-color: #2b260b #e1dbcf; 
}

/* WebKit (Chrome, Edge, Safari) */
html::-webkit-scrollbar,
body::-webkit-scrollbar,
*::-webkit-scrollbar {
  width: 12px;
}

html::-webkit-scrollbar-track,
body::-webkit-scrollbar-track,
*::-webkit-scrollbar-track {
  background: #c8d1c5; /* חום כהה */
}

html::-webkit-scrollbar-thumb,
body::-webkit-scrollbar-thumb,
*::-webkit-scrollbar-thumb {
  background-color: #2b260b; /* הבהיר */
  border-radius: 10px;
}

html::-webkit-scrollbar-thumb:hover,
body::-webkit-scrollbar-thumb:hover,
*::-webkit-scrollbar-thumb:hover {
  background-color: #e4e9e0; /* קצת יותר בהיר בהובר */
}






/* =====  Icons ===== */

.tab-btn .icon-img {
  width: 20px; 
  height: 20px;
  object-fit: contain;
  margin-right: -2px; 
  vertical-align: middle;
}



.tab-btn .scan-icon {
  width: 20px;
  height: 20px;
  object-fit: contain;
  margin-left: -2px; 
  vertical-align: middle;
}





.logout-icon {
  width: 18px;
  height: 18px;
  object-fit: contain;
  margin-left: -2px; 
  vertical-align: middle;
}




.tab-btn {
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.tab-btn:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.small-btn {
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.small-btn:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.menu-icon {
  width: 20px;
  height: 20px;
  object-fit: contain;
}






.brand-left {
  display: flex;
  align-items: center;
  gap: 8px; /* רווח בין הלוגו לטקסט */
}

.brand-logo {
  width: 32px;
  height: 32px;
  object-fit: contain;
}















/* ===== STORAGE WIDGET (במקום כפתור התנתקות) ===== */

.storage-widget {
  background: rgba(0, 0, 0, 0.18);
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 0.75rem;
  color: #052806;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.storage-label-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: 600;
}

.storage-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.storage-bar {
  position: relative;
  width: 100%;
  height: 6px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.14);
  overflow: hidden;
}

.storage-bar-fill {
  position: absolute;
  inset: 0;
  /* width מוגדר ב-JavaScript דינמית */
  border-radius: inherit;
  background: linear-gradient(90deg, #B4C282, #57C785);
  transition: width 0.3s ease;
}

.storage-percent {
  font-size: 0.72rem;
  opacity: 0.9;
}

.storage-text {
  font-size: 0.72rem;
  opacity: 0.85;
  text-align: right;
  direction: rtl;
}

/* במובייל – שיהיה טיפונת יותר קומפקטי */
@media (max-width: 768px) {
  .storage-widget {
    padding: 8px 10px;
    font-size: 0.7rem;
  }

  .storage-text {
    font-size: 0.68rem;
  }
}



/* ====== MODERN SEARCH BOX ====== */
/* ====== MODERN SEARCH BOX ====== */
.search-wrapper {
  display: flex;
  align-items: center;
  /* במסך גדול ~260px, במסך קטן יכול להתכווץ */
  flex: 1 1 260px;
  max-width: 100%;
  background: #f3f3f1;
  border-radius: 30px;
  border: 1px solid #d3d3d3;
  flex-direction: row-reverse;
  overflow: hidden;
}



.top-row {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  flex-wrap: wrap; /* חשוב!! מאפשר להתכווץ */
}



@media (max-width: 480px) {
  .search-wrapper {
    width: 70vw;        /* עוד יותר קטן במובייל */
  }

  .search-input {
    font-size: 0.8rem;
    padding: 6px 8px;
  }

  .search-btn {
    width: 32px;
    height: 32px;
  }
}
/* ===== כותרת מסך קטגוריה במובייל ===== */
@media (max-width: 600px) {

  .category-view-header {
    display: flex;
    flex-wrap: wrap;      /* שורה נשברת לכמה שורות */
    gap: .4rem;
    align-items: flex-start;
  }

  .back-button {
    font-size: .75rem;
    padding: .25rem .5rem;
  }

  .category-title {
    flex: 1 1 100%;       /* כותרת תופסת שורה שלמה */
    font-size: 1rem;
  }

  .search-wrapper {
    order: 3;             /* ירד לשורה מתחת */
    flex: 1 1 100%;
    width: 100%;
    max-width: 100%;
  }

  #sortSelect {
    order: 4;             /* גם הסלקט (תאריך העלאה) בשורה נפרדת */
    flex: 1 1 100%;
    width: 100%;
    font-size: .75rem;
    margin-top: .2rem;
  }
}





.search-btn {
  background: #15310a;
  width: 42px;
  height: 38px;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.search-btn img {
  width: 18px;
  height: 18px;
}

.search-input {
  flex: 1;
  padding: 10px 14px;
  border: none;
  outline: none;
  background: transparent;
  font-size: 14px;
  color: #333;
  font-family: "Rubik", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* צבע ברור ל־placeholder "חיפוש..." */
.search-input::placeholder {
  color: #999;
}



/* ✅ שהאחסון יופיע תמיד במובייל בתוך הגלילה */
@media (max-width: 760px) {
  .sidebar {
    display: block !important;
    height: 100vh !important;
    overflow-y: auto !important;   /* כל הצד גולל */
  }

  .sidebar-content {
    flex: none !important;         /* לא "תופס" את כל הגובה לבד */
    max-height: none !important;
    overflow: visible !important;  /* שאר הדברים (כולל האחסון) יהיו ברצף */
  }

  .sidebar-bottom {
    position: static !important;   /* לא מודבק לתחתית */
    margin-top: 150px !important;
    padding-bottom: 24px !important;  /* קצת מקום לפני הקצה של המסך */
    background: inherit;
  }
}







  </style>
</head>

<body>
<!-- PDF.js מהפרויקט המקומי שלנו -->
<script src="./libs/pdf.min.js"></script>
<script src="./libs/pdf.worker.min.js"></script>
<script>
  if (window['pdfjsLib']) {
    window['pdfjsLib'].GlobalWorkerOptions.workerSrc = "./libs/pdf.worker.min.js";
    console.log("✅ pdfjsLib loaded (local)", window['pdfjsLib'].version || "no version field but loaded");
  } else {
    console.warn("⚠️ pdfjsLib failed to load (local)");
  }
</script>

<!-- Tesseract.js ל-OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
  if (window.Tesseract) {
    console.log("✅ Tesseract loaded");
  } else {
    console.warn("⚠️ Tesseract failed to load");
  }
</script>





<!-- jsPDF - יצירת PDF מצד הלקוח -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
  if (window.jspdf && window.jspdf.jsPDF) {
    console.log("✅ jsPDF loaded");
  } else {
    console.warn("⚠️ jsPDF failed to load");
  }
</script>



<!-- EXIF.js - בשביל לזהות כיוון צילום של המצלמה -->
<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
<script>
  if (window.EXIF) {
    console.log("✅ EXIF loaded");
  } else {
    console.warn("⚠️ EXIF failed to load");
  }
</script>



<!-- PayPal JS SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=AbUz2lrbd6s8-4otSBVJmSyozV8uEYv9Xs1C1y2s-Z1NwnQrkcgIff_lEqKLeoj9QuUg_SLGlZy7qMr8&currency=ILS&intent=capture"></script>





  <div class="dashboard">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar" id="sidebarDrawer">
      <div class="sidebar-content">
<div class="brand-block">
  <div class="brand-row">

    <!-- X בצד שמאל -->
    <button id="closeMenuBtn" class="close-btn" aria-label="סגור">✕</button>

    <!-- לוגו + טקסט אחריו -->
    <div class="brand-left">
      <img src="assests/icons/logo.png" alt="EcoDocs Logo" class="brand-logo">
      <div class="brand-name">NestyFile</div>
    </div>

  </div>

  <div class="brand-sub">ארכיון חכם • שמור • אישי</div>
</div>


        <div class="user-panel">
          <div class="user-panel-name" id="currentUserLabel">שלום, משתמש!</div>
          <div class="user-panel-mail" id="currentUserEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="443137213604213c25293428216a272b29">[email&#160;protected]</a></div>
        </div>

        <nav class="menu">
          <div class="menu-label">ניווט</div>

          <button class="menu-item active" data-view="home">
  <div class="menu-item-icon">
    <img src="assests/icons/home.png" alt="Home Icon" class="menu-icon">
  </div>
  <span>דף הבית</span>
</button>


          <button class="menu-item" data-view="shared">
  <div class="menu-item-icon">
    <img src="assests/icons/share.png" alt="Shared Storage Icon" class="menu-icon">
  </div>
  <span>אחסון משותף</span>
</button>


          <button class="menu-item" data-view="profiles">
  <div class="menu-item-icon">
    <img src="assests/icons/profile.png" alt="Profiles Icon" class="menu-icon">
  </div>
  <span>פרופילים</span>
</button>


          <button class="menu-item" data-view="recycle">
  <div class="menu-item-icon">
    <img src="assests/icons/trash.png" alt="Recycle Icon" class="menu-icon">
  </div>
  <span>סל מחזור</span>
</button>

          <button class="menu-item" data-view="settings">
  <div class="menu-item-icon">
    <img src="assests/icons/settings.png" alt="Settings Icon" class="menu-icon">
  </div>
  <span>הגדרות</span>
</button>


          
          
        </nav>
      </div>

      <div class="sidebar-bottom">
  <div class="storage-widget" id="storageWidget" aria-label="מצב אחסון">
    <div class="storage-label-row">
      <span class="storage-label">אחסון</span>
      <span class="storage-percent" id="storageUsagePercent">0%</span>
    </div>

    <div class="storage-bar">
      <div class="storage-bar-fill" id="storageUsageBarFill"></div>
    </div>

    <div class="storage-text" id="storageUsageText">
      אחסון פנוי: 0.5GB מתוך 0.5GB
    </div>
  </div>
</div>

    </aside>

    <!-- ===== MAIN AREA ===== -->
    <section class="main-area">
      <!-- בר עליון -->
      <header class="top-bar">
        <div class="top-left">
          <h1 style="color: #505733; font-size:large;" class="page-title">הארכיון שלי</h1>
          <h1 style="color: #505733; font-size:small;" class="page-title">כל המסמכים שלך במקום אחד</h1>
        </div>

        <div class="top-right">

          
  <!-- כפתור פרימיום חדש -->
  <button class="premium-btn" id="premiumBtn"> פרימיום</button>
  <!-- תפריט מובייל -->
  <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>

  <!-- Logout במובייל -->
  <button class="logout-btn mobile-logout" id="mobileLogoutBtn">🚪 התנתקות</button>

  <!-- כפתור העלאת קובץ -->
<button class="small-btn" id="topLogoutBtn">
  <img src="assests/icons/logout.png" alt="Logout Icon" class="logout-icon">
  התנתקות
</button>


  <input
    type="file"
    id="fileInput"
    class="hidden-input"
    accept=".pdf,.jpg,.jpeg,.png,.webp,.heic,.bmp,.doc,.docx"
  />

</div>

      </header>

      <!-- טאבים (משתמשת בהמשך בעיקר למיון/תצוגה) -->
      <div class="tabs-bar">
  <!-- כפתור העלאת מסמך בשורת הטאבים -->
 <button class="tab-btn active" id="uploadBtn">
  <img src="assests/icons/uploadDark.png" alt="Upload" class="icon-img">
  העלה מסמך
</button>

  <!-- כפתור סריקת מסמך במקום "לפי שנה" -->
<button class="tab-btn" id="scanBtn">
  <img src="assests/icons/scanDark.png" alt="Scan Icon" class="scan-icon">
  סרוק מסמך
</button>

</div>


      <!-- אזור התוכן -->
      <div class="content-scroll-area">
        <!-- מסך בית: כרטיסי תיקיות -->
        <section class="home-view" id="homeView">
          <h2 class="view-title">התיקיות שלך</h2>
          <div class="folder-grid" id="folderGrid"></div>
        </section>

        <!-- מסך קטגוריה -->
        <section class="category-view hidden" id="categoryView">
          <div class="category-view-header">
            <button class="back-button" id="backButton">⬅ חזרה</button>
            <h2 class="category-title" id="categoryTitle">שם תיקייה</h2>


            <!-- שורת חיפוש במסמכים -->
<div class="search-wrapper">
  <button class="search-btn">
    <img src="assests/icons/search.png" alt="search" />
  </button>

  <input
    id="categorySearch"
    type="text"
    placeholder="חיפוש..."
    class="search-input"
  />
</div>

    <!-- חיפוש לפי שייך ל
<input
  id="recipientSearch"
  type="text"
  placeholder="חיפוש לפי 'שייך ל'..."
  style="margin-right:0.75rem; padding:.4rem .6rem; border-radius:6px; border:1px solid #ccc; font-size:.75rem; min-width:160px; margin-top:6px;"
/> -->



            <!-- שומר את אותו select כמו שהיה לך, + שתי אפשרויות מיון לפי אחריות -->
            <select id="sortSelect"  style="margin-right:auto; font-size:.75rem; padding:.4rem .5rem; border-radius:12px; background: #cacab7;">
              <option value="uploadedAt-desc">תאריך העלאה (חדש בהתחלה)</option>
              <option value="uploadedAt-asc">תאריך העלאה (ישן בהתחלה)</option>
              <option value="org-asc">לפי ארגון א→ת</option>
              <option value="org-desc">לפי ארגון ת→א</option>
              <option value="year-desc">שנה (חדש קודם)</option>
              <option value="year-asc">שנה (ישן קודם)</option>
              <option value="title-asc">שם קובץ א→ת</option>
              <option value="title-desc">שם קובץ ת→א</option>
              <option value="warrantyStart-desc">תאריך קנייה (חדש קודם)</option>
              <option value="warrantyStart-asc">תאריך קנייה (ישן קודם)</option>
              <option value="warrantyExpiresAt-asc">פג תוקף אחריות (מוקדם קודם)</option>
              <option value="warrantyExpiresAt-desc">פג תוקף אחריות (מאוחר קודם)</option>
            </select>
          </div>

          <!-- כאן שורת תתי־תיקיות -->
  <div id="subfoldersBar" class="subfolders-bar"></div>

          <div class="docs-list" id="docsList"></div>
        </section>


        <!-- === אחסון משותף === -->
<section class="shared-view hidden" id="sharedView">
  <div class="shared-container">

    <!-- בלוק ראשון: בקשות ממתינות -->
    <section class="shared-block pending-wrap">
      <div class="cozy-head">
        <h3>בקשות ממתינות</h3>
      </div>
      <div id="pendingList" class="sf-list">
        <!-- כאן ייכנסו בקשות ממתינות -->
      </div>
    </section>

    <!-- בלוק שני: תיקיות משותפות -->
    <section class="shared-block folders-wrap">
      <div class="cozy-head">
        <h3>תיקיות משותפות</h3>
        <button class="btn-cozy" id="createSharedFolderBtn">➕ צור תיקייה משותפת</button>
      </div>
      <div id="sharedFoldersGrid" class="docs-list shared-mode">
        <!-- כאן ייכנסו התיקיות -->
      </div>
    </section>

    <!-- בלוק שלישי: מסמכים משותפים -->
    <section class="shared-block documents-wrap">
      <div class="cozy-head">
        <h3>מסמכים משותפים</h3>
      </div>
      <div id="sharedDocsList" class="docs-list shared-mode">
        <!-- כאן ייכנסו המסמכים -->
      </div>
    </section>

  </div>
</section>


      </div>
    </section>
  </div><!-- /dashboard -->

  <!-- התראות צפות -->
  <div id="notification" class="notification hidden"></div>
    <!-- סריקת מסמך - תצוגה מקדימה לפני העלאה -->
  <div id="scanModal" class="hidden" style="
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    font-family: 'Rubik', system-ui, sans-serif;
  ">
    <div style="
      background: #fff;
      color: #000;
      min-width: 320px;
      max-width: 95vw;
      max-height: 95vh;
      width: 480px;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0,0,0,.35);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    ">
      <div style="
        padding: .6rem .9rem;
        border-bottom: 1px solid #ddd;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: .5rem;
      ">
        <h2 style="margin:0; font-size:.95rem; font-weight:600;">סריקת מסמך</h2>
        <button id="scanCloseBtn" type="button" style="
          border:none;
          background:transparent;
          font-size:1rem;
          cursor:pointer;
        ">✖</button>
      </div>

      <div style="padding:.75rem .9rem; flex:1; overflow:auto;">
        <div id="scanEmptyState" style="font-size:.85rem; color:#666; text-align:center; margin-top:1.5rem;">
          צלמי עמוד ראשון כדי להתחיל ✨
        </div>
        <div id="scanPagesContainer" style="display:flex; flex-direction:column; gap:.75rem;"></div>
      </div>

      <div style="
        padding:.6rem .9rem;
        border-top:1px solid #ddd;
        display:flex;
        gap:.5rem;
        justify-content:space-between;
      ">
        <button id="scanAddPageBtn" type="button" style="
          flex:1;
          padding:.5rem .75rem;
          border-radius:999px;
          border:none;
          cursor:pointer;
          background:#eef5ff;
          color:#114488;
          font-weight:600;
          font-size:.85rem;
        ">➕ עמוד נוסף</button>

        <button id="scanUploadBtn" type="button" style="
          flex:1;
          padding:.5rem .75rem;
          border-radius:999px;
          border:none;
          cursor:pointer;
          background:#2ecc71;
          color:#fff;
          font-weight:600;
          font-size:.85rem;
          opacity:.6;
        " disabled>📤 העלאה</button>
      </div>
    </div>
  </div>


  <!-- עורך מסמך -->
<!-- עורך מסמך -->
<div id="editModal" class="hidden" style="
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  font-family: 'Rubik', system-ui, sans-serif;
">
  <div style="
    background: #fff;
    color: #000;
    min-width: 320px;
    max-width: 90vw;
    width: 400px;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0,0,0,.4);
    padding: 1rem 1rem 0.5rem;
    display: flex;
    flex-direction: column;
    gap: .75rem;
  ">

    <h2 style="margin:0; font-size:.9rem; font-weight:600; color:#000;">
      עריכת פרטי המסמך
    </h2>

    <form id="editForm" style="display:flex; flex-direction:column; gap:.5rem; font-size:.8rem;">

      <label>
        שם קובץ:
        <input id="edit_title" type="text" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        ארגון:
        <input id="edit_org" type="text" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        שנה:
        <input id="edit_year" type="number" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        שייך ל (מופרד בפסיקים):
        <input id="edit_recipient" type="text" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        תאריך קנייה / התחלה (yyyy-mm-dd):
        <input id="edit_warrantyStart" type="date" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        תוקף אחריות עד (yyyy-mm-dd):
        <input id="edit_warrantyExpiresAt" type="date" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        מחיקה אוטומטית אחרי (yyyy-mm-dd):
        <input id="edit_autoDeleteAfter" type="date" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        קטגוריה:
        <input id="edit_category" type="text" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <label>
        שותף עם (אימיילים בפסיקים):
        <input id="edit_sharedWith" type="text" style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #bbb;">
      </label>

      <div style="display:flex; gap:.5rem; margin-top:.75rem; justify-content:flex-end;">
        <button type="button" id="editCancelBtn"
          style="background:#b63a3a; color:#fff; border:0; border-radius:6px; font-weight:600; padding:.5rem .75rem; cursor:pointer;">
          ביטול
        </button>

        <button type="submit" id="editSaveBtn"
          style="background:#0e3535; color:#fff; border:0; border-radius:6px; font-weight:600; padding:.5rem .75rem; cursor:pointer;">
          שמירה
        </button>
      </div>
    </form>
  </div>
</div>



<div id="loading-overlay" class="loading-overlay hidden ">
  <div class="loading-stack">
    <div class="tetro-frame">
      <div class="tetrominos">
        <div class="tetromino box1"></div>
        <div class="tetromino box2"></div>
        <div class="tetromino box3"></div>
        <div class="tetromino box4"></div>
      </div>
    </div>
    <p class="loading-text">מזהה טקסט... אנא המתיני</p>
  </div>
</div>



<!-- Premium Panel (Modal) -->
<div id="premiumPanel" class="modal-backdrop hidden" dir="rtl" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="premiumTitle" tabindex="-1">
    <div class="modal-head">
      <h2 id="premiumTitle">בחרו תוכנית</h2>
      <button class="modal-close" id="premiumCloseBtn" aria-label="סגור">✖</button>
    </div>


     <div class="scroll-area">
    <p class="muted">שדרגו את Eco-Files כדי לקבל עוד שטח אחסון, שיתופים ללא הגבלה ותכונות חכמות.</p>

    <div class="plans-grid">
      <!-- Free -->
      <article class="plan" data-plan="free" aria-label="תוכנית חינם">
        <header>
          <h3>חינם</h3>
          <div class="price">₪0<span class="per">/חודש</span></div>
        </header>
        <ul class="features">
          <li>אחסון עד 1GB</li>
          <li>תיקייה משותפת אחת</li>
          <li>העלאות בסיסיות</li>
        </ul>
        <button class="btn btn-ghost" disabled>נוכחי</button>
      </article>

      <!-- Pro -->
      <article class="plan" data-plan="pro" aria-label="תוכנית פרו">
        <header>
          <h3>פרו</h3>
          <div class="price">₪11<span class="per">/חודש</span></div>
        </header>
        <ul class="features">
          <li>אחסון עד 10GB</li>
          <li>שיתוף עד 5 משתמשים</li>
          <li>תיוגים וחיפוש חכם</li>
          <li>OCR מהיר</li>
        </ul>
        <button class="btn" data-select-plan="pro">בחר פרו</button>
      </article>

      <!-- Premium -->
      <article class="plan plan-accent" data-plan="premium" aria-label="תוכנית פרימיום">
        <header>
          <h3>פרימיום 💎</h3>
          <div class="price">₪29<span class="per">/חודש</span></div>
        </header>
        <ul class="features">
          <li>אחסון בלתי מוגבל</li>
          <li>שיתוף ללא הגבלה</li>
          <li>AI סיווג וסריקה אוטומטית</li>
          <li>סנכרון בזמן אמת ותמיכה בעדיפות</li>
        </ul>
        <button class="btn btn-accent" data-select-plan="premium">בחר פרימיום</button>
      </article>
    </div>
    </div>

    <div class="modal-foot" style="display:flex; flex-direction:column; gap:8px;">
  <!-- פה PayPal ירנדר את הכפתור -->
  <div id="paypalButtonsContainer" style="width:100%; display:flex; justify-content:center;"></div>


  <button class="btn" id="premiumLaterBtn">אולי אחר-כך</button>
</div>

  </div>
</div>


<!-- Settings Panel -->
<div id="settingsPanel" class="modal-backdrop hidden" dir="rtl">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" tabindex="-1">
    <header class="modal-head">
      <h2 id="settingsTitle">הגדרות</h2>
      <button class="icon-btn" data-close aria-label="סגור">
        ✖
      </button>
    </header>

    <div class="scroll-area">
      <!-- Appearance -->
      <section class="section">
        <h3 class="section-title">מראה</h3>

        <!-- Theme chooser -->
        <!-- Theme chooser -->
<div class="card">
  <label class="block-label">ערכת צבע</label>
  <div class="theme-row" role="radiogroup" aria-label="Theme">
    <label class="pill">
      <input type="radio" name="theme" value="light" id="themeLight">
      <span>מצב בהיר</span>
    </label>
    <label class="pill">
      <input type="radio" name="theme" value="dark" id="themeDark">
      <span>מצב כהה</span>
    </label>
  </div>
</div>

        
      </section>

      <!-- Behavior -->
      <section class="section">
        <h3 class="section-title">התנהגות</h3>
        <div class="grid-2">
          <div class="card">
            <label class="block-label">מחיקה</label>
            <label class="switch">
              <input type="checkbox" id="toggleConfirmDelete">
              <span class="switch-ui"></span>
              <span class="switch-text">אישור לפני מחיקה</span>
            </label>
            <p class="hint">יבקש אישור לפני מחיקת קובץ או תיקייה.</p>
          </div>

         
        </div>
      </section>

      <label>
  <input type="checkbox" id="twoFactorToggle">
  הפעל אימות דו-שלבי (קוד במייל בכל התחברות)
</label>

    </div>

    <footer class="modal-foot">
      <button class="btn" data-close>סגור</button>
    </footer>
  </div>
</div>




<!-- 🔹 חלון הוסף פרופיל -->
<!-- מודל פרופיל -->
<div id="profileModalBackdrop" class="modal-backdrop hidden" aria-hidden="true"
     style="position:fixed; inset:0; background:rgba(0,0,0,0.35); display:flex; align-items:center; justify-content:center; z-index:2000;">
  <div class="modal-panel"
       style="background:#fff; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.3); padding:1rem 1rem 0; min-width:260px;">
    
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:.75rem;">
      <h2 id="profileModalTitle" style="margin:0; font-size:1rem; font-weight:600;">הוסף פרופיל</h2>
      <button id="profileModalCloseBtn"
              style="border:none; background:transparent; font-size:1.1rem; cursor:pointer;">✕</button>
    </div>

    <!-- תצוגת תמונה -->
    <div style="display:flex; justify-content:center; margin-bottom:.75rem;">
      <div id="profilePhotoPreview"
           style="width:72px; height:72px; border-radius:50%; border:2px solid #4b6bfb; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:1.2rem; overflow:hidden;">
        +
      </div>
    </div>

    <div style="display:flex; flex-direction:column; gap:.5rem; font-size:.85rem;">
      <label>
        שם מלא:
        <input id="profileFullName" type="text"
               style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #ccc;">
      </label>

      <label>
        תעודת זהות (לא חובה):
        <input id="profileIdNumber" type="text"
               style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #ccc;">
      </label>

      <label>
        תאריך לידה:
        <input id="profileBirthDate" type="date"
               style="width:100%; padding:.4rem; border-radius:6px; border:1px solid #ccc;">
      </label>

      <label>
        תמונת פרופיל (לא חובה):
        <input id="profilePhotoInput" type="file" accept="image/*">
      </label>
    </div>

    <div style="display:flex; justify-content:flex-end; gap:.5rem; margin-top:1rem; padding-bottom:.75rem;">
      <button id="profileModalCancelBtn"
              style="border:none; background:#eee; padding:.35rem .8rem; border-radius:6px; cursor:pointer;">
        ביטול
      </button>
      <button id="profileModalSaveBtn"
              style="border:none; background:#4b6bfb; color:#fff; padding:.35rem .9rem; border-radius:6px; cursor:pointer;">
        שמירה
      </button>
    </div>
  </div>
</div>






<!-- Remove ALL inline Firebase initialization -->
<!-- authCheck.js will handle everything -->



<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="module" src="./firebase-config.js"></script>
<script type="module" src="./JS/authCheck.js"></script>
 <script type="module" src="./api-bridge.js"></script> 
<script type="module" src="./JS/main.js"></script>

<script type="module" src="./JS/shared-folders-navigation-fix.js"></script>
<script src="./JS/subfolders-navigation-fix.js"></script>
<script>
  // Around line 1800+ in main.js - AFTER DOMContentLoaded


  // ===== Firestore User Data Helpers (Required for 2FA) =====
// ===== Firestore User Data Helpers (Required for 2FA) =====
async function loadUserDataFromFirestore(email) {
    try {
      if (!window.isFirebaseAvailable || !window.isFirebaseAvailable()) {
        console.warn("❌ Firebase לא זמין כרגע (fs/db חסרים או אין אינטרנט)");
        return null;
      }

      const key = (email || "").trim().toLowerCase();
      if (!key) {
        console.warn("loadUserDataFromFirestore: אימייל ריק");
        return null;
      }

      const userRef = window.fs.doc(window.db, "users", key);
      const snapshot = await window.fs.getDoc(userRef);

      if (snapshot.exists()) {
        return snapshot.data();
      }
      return null;
    } catch (err) {
      console.error("❌ Error loading user data:", err);
      return null;
    }
  }

  async function saveUserDataToFirestore(email, data) {
    try {
      if (!window.isFirebaseAvailable || !window.isFirebaseAvailable()) {
        console.warn("❌ Firebase לא זמין כרגע (fs/db חסרים או אין אינטרנט)");
        return false;
      }

      const key = (email || "").trim().toLowerCase();
      if (!key) {
        console.warn("saveUserDataToFirestore: אימייל ריק");
        return false;
      }

      const userRef = window.fs.doc(window.db, "users", key);
      await window.fs.setDoc(userRef, data, { merge: true });
      return true;
    } catch (err) {
      console.error("❌ Error saving user data:", err);
      return false;
    }
  }





document.addEventListener("DOMContentLoaded", async () => {
  console.log("📄 DOM Content Loaded");
  
  // ===== WAIT FOR AUTH =====
  // Don't do anything until we know if user is logged in
  await new Promise(resolve => {
    if (window.userNow) {
      resolve();
    } else {
      window.addEventListener('firebase-ready', resolve, { once: true });
      // Timeout after 5 seconds
      setTimeout(resolve, 5000);
    }
  });

  const currentUser = getCurrentUser();
  if (!currentUser) {
    console.warn("⚠️ No user logged in");
    return;
  }

  console.log("👤 Current user:", currentUser);

  // ===== NOW SAFE TO ATTACH EVENTS =====
  const uploadBtn = document.getElementById("uploadBtn");
  const fileInput = document.getElementById("fileInput");
  const backButton = document.getElementById("backButton");
  const sortSelect = document.getElementById("sortSelect");
  
  // Mobile menu
  const mobileMenuBtn = document.getElementById("mobileMenuBtn");
  const closeMenuBtn = document.getElementById("closeMenuBtn");
  const sidebar = document.querySelector(".sidebar");
  
  if (mobileMenuBtn && sidebar) {
    mobileMenuBtn.addEventListener("click", () => {
      sidebar.classList.add("open");
    });
  }
  
  if (closeMenuBtn && sidebar) {
    closeMenuBtn.addEventListener("click", () => {
      sidebar.classList.remove("open");
    });
  }

  // Upload button
  // Upload button - handled in main.js

  // Back button
  if (backButton) {
    backButton.addEventListener("click", () => {
      console.log("⬅ Back button clicked");
      if (typeof renderHome === 'function') {
        renderHome();
      }
    });
  }

  // Sort select
  if (sortSelect) {
    sortSelect.addEventListener("change", () => {
      const [field, dir] = sortSelect.value.split("-");
      currentSortField = field;
      currentSortDir = dir;
      
      const categoryTitle = document.getElementById("categoryTitle");
      if (categoryTitle && !categoryView.classList.contains("hidden")) {
        openCategoryView(categoryTitle.textContent);
      }
    });
  }

// Logout buttons
const logoutBtn = document.getElementById("logoutBtn");
const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");
const topLogoutBtn = document.getElementById("topLogoutBtn");

if (logoutBtn) {
  logoutBtn.addEventListener("click", window.handleLogout);
}
if (mobileLogoutBtn) {
  mobileLogoutBtn.addEventListener("click", window.handleLogout);
}
if (topLogoutBtn) {
  topLogoutBtn.addEventListener("click", window.handleLogout);
}


  // Menu items (sidebar navigation)
  document.querySelectorAll(".menu-item").forEach(item => {
    item.addEventListener("click", (e) => {
      const view = e.currentTarget.getAttribute("data-view");
      console.log("🔘 Menu item clicked:", view);
      
      // Remove active from all
      document.querySelectorAll(".menu-item").forEach(i => i.classList.remove("active"));
      e.currentTarget.classList.add("active");
      
      if (view === "home" && typeof renderHome === 'function') {
        renderHome();
      } else if (view === "shared" && typeof openSharedView === 'function') {
        openSharedView();
        } else if (view === "profiles" && typeof openProfilesView === 'function') {
  // 🔹 חדש – לפתוח מסך פרופילים
  openProfilesView();

      } else if (view === "recycle" && typeof openRecycleView === 'function') {
        openRecycleView();
      } else if (view === "settings") {
        // Open settings panel
        const settingsPanel = document.getElementById("settingsPanel");
        if (settingsPanel) {
          settingsPanel.classList.remove("hidden");
          //settingsPanel.setAttribute("aria-hidden", "false");
        }
      }
    });
  });

  // ===== SETTINGS PANEL HANDLERS =====
  const settingsPanel = document.getElementById("settingsPanel");
  
  // Close settings panel
  if (settingsPanel) {
    settingsPanel.querySelectorAll("[data-close]").forEach(btn => {
      btn.addEventListener("click", () => {
        settingsPanel.classList.add("hidden");
        //settingsPanel.setAttribute("aria-hidden", "true");
      });
    });
    
    // Close on backdrop click
    settingsPanel.addEventListener("click", (e) => {
      if (e.target === settingsPanel) {
        settingsPanel.classList.add("hidden");
        //settingsPanel.setAttribute("aria-hidden", "true");
      }
    });
  }

  // Theme switcher
  const themeLight = document.getElementById("themeLight");
  const themeDark = document.getElementById("themeDark");
  
  if (themeLight && themeDark) {
    // Load saved theme
    const savedTheme = localStorage.getItem("theme") || "light";
    if (savedTheme === "dark") {
      themeDark.checked = true;
      document.documentElement.classList.add("theme-dark");
    } else {
      themeLight.checked = true;
      document.documentElement.classList.remove("theme-dark");
    }
    
    // Theme change handlers
    themeLight.addEventListener("change", () => {
      if (themeLight.checked) {
        document.documentElement.classList.remove("theme-dark");
        localStorage.setItem("theme", "light");
      }
    });
    
    themeDark.addEventListener("change", () => {
      if (themeDark.checked) {
        document.documentElement.classList.add("theme-dark");
        localStorage.setItem("theme", "dark");
      }
    });
  }

  // Confirm delete toggle
  const toggleConfirmDelete = document.getElementById("toggleConfirmDelete");
  if (toggleConfirmDelete) {
    const savedConfirm = localStorage.getItem("confirmDelete") !== "false";
    toggleConfirmDelete.checked = savedConfirm;
    
    toggleConfirmDelete.addEventListener("change", () => {
      localStorage.setItem("confirmDelete", toggleConfirmDelete.checked);
      console.log("Confirm delete:", toggleConfirmDelete.checked);
    });
  }

    // ===== 2FA TOGGLE (אימות דו-שלבי) =====
  const twoFactorToggle = document.getElementById("twoFactorToggle");
  if (twoFactorToggle) {
    // נטען מה־Firestore אם כבר שמור למשתמש הנוכחי
    try {
      const userData = await loadUserDataFromFirestore(currentUser);
      if (userData && userData.twoFactorEnabled) {
        twoFactorToggle.checked = true;
      } else {
        twoFactorToggle.checked = false;
      }
    } catch (err) {
      console.error("Error loading 2FA setting:", err);
    }

    // כשמשנים את הצ'קבוקס – נשמור לפיירסטור
    twoFactorToggle.addEventListener("change", async (e) => {
      const enabled = e.target.checked;
      try {
        await updateTwoFactorSetting(currentUser, enabled);
        console.log("twoFactorEnabled updated to:", enabled);
      } catch (err) {
        console.error("Error updating 2FA setting:", err);
        alert("שגיאה בעדכון אימות דו-שלבי. נסי שוב.");
        e.target.checked = !enabled; // מחזירים למצב הקודם אם נכשל
      }
    });
  }


  console.log("✅ All event handlers attached");
});

async function updateTwoFactorSetting(email, enabled) {
  if (!email) {
    console.error("❌ אין אימייל, לא ניתן לעדכן twoFactorEnabled");
    return;
  }

  let userData = await loadUserDataFromFirestore(email);
  if (!userData) {
    userData = {
      email,
      docs: [],
      createdAt: new Date().toISOString(),
    };
  }

  userData.twoFactorEnabled = enabled;
  await saveUserDataToFirestore(email, userData);
  console.log("✅ twoFactorEnabled נשמר ל:", email, "=", enabled);
}



</script>


<!-- 🔔 ROOT לכל ההודעות היפות -->
<div id="eco-alert-root"></div>





<div id="eco-confirm-overlay" class="overlay" style="display: none;">
  <div class="popup">
    <p id="eco-confirm-message"></p>
    <div class="buttons">
      <button id="eco-confirm-no" class="btn btn-cancel">לא</button>
      <button id="eco-confirm-yes" class="btn btn-primary">כן</button>
    </div>
  </div>
</div>


</body>
</html>